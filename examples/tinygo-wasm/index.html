<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>TinyGo WebAssembly Example</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #333;
        }
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
        }
        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #results {
            margin-top: 20px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>TinyGo WebAssembly Example</h1>
    
    <h2>Add Two Numbers</h2>
    <div>
        <input type="number" id="num1" value="5" /> +
        <input type="number" id="num2" value="7" />
        <button id="addButton">Calculate</button>
        <div>Result: <span id="addResult">-</span></div>
    </div>

    <h2>Greeting</h2>
    <div>
        <input type="text" id="name" value="World" />
        <button id="greetButton">Greet</button>
        <div>Result: <span id="greetResult">-</span></div>
    </div>

    <h2>WebAssembly Information</h2>
    <div id="results">
        <div>Status: <span id="wasmStatus">Loading...</span></div>
    </div>

    <h2>How to Build This Example</h2>
    <pre>
# Navigate to this example
cd examples/tinygo-wasm

# Build the WebAssembly module
tgo-wasm -o main.wasm -target wasm main.go

# Serve this directory (you can use any HTTP server)
python3 -m http.server
# Then visit http://localhost:8000
    </pre>

    <script>
        // Function to load the WebAssembly module
        async function loadWasm() {
            const wasmStatus = document.getElementById('wasmStatus');
            
            try {
                // Instantiate the WebAssembly module
                const go = new Go(); // Go class comes from wasm_exec.js
                const result = await WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject);
                
                // Run the Go instance
                go.run(result.instance);
                
                wasmStatus.innerText = "WebAssembly module loaded successfully!";
                
                // Set up the event listeners
                document.getElementById('addButton').addEventListener('click', () => {
                    const num1 = parseInt(document.getElementById('num1').value);
                    const num2 = parseInt(document.getElementById('num2').value);
                    const result = window.add(num1, num2);
                    document.getElementById('addResult').innerText = result;
                });
                
                document.getElementById('greetButton').addEventListener('click', () => {
                    const name = document.getElementById('name').value;
                    const result = window.greet(name);
                    document.getElementById('greetResult').innerText = result;
                });
            } catch (err) {
                wasmStatus.innerText = `Error loading WebAssembly: ${err.message}`;
                console.error("Error loading WebAssembly:", err);
            }
        }

        // Load the WebAssembly module when the page loads
        window.addEventListener('load', () => {
            // We need to check if the wasm_exec.js script is loaded first
            if (typeof Go === 'undefined') {
                const script = document.createElement('script');
                script.src = '/usr/local/lib/tinygo/targets/wasm_exec.js'; // Path to TinyGo's wasm_exec.js
                script.onload = loadWasm;
                script.onerror = () => {
                    document.getElementById('wasmStatus').innerText = 
                        "Error: Could not load wasm_exec.js. Make sure TinyGo is installed and run this page from a server.";
                };
                document.head.appendChild(script);
            } else {
                loadWasm();
            }
        });
    </script>
</body>
</html>
